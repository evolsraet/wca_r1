# ğŸ“‹ ê²Œì‹œíŒ í•„í„° ì‹œìŠ¤í…œ ì‚¬ìš©ë²• (ì§ì ‘ í• ë‹¹ ë°©ì‹)

## ğŸ¯ ê°œìš”
ê²Œì‹œíŒì˜ í•„í„° ì‹œìŠ¤í…œì´ **ì§ê´€ì ì¸ ì§ì ‘ í• ë‹¹ ë°©ì‹**ìœ¼ë¡œ ê°„ì†Œí™”ë˜ì—ˆìŠµë‹ˆë‹¤.
`whereBuilder` ìŠ¤í† ì–´ëŠ” ìˆœìˆ˜í•˜ê²Œ where ì ˆ ì¡°í•© ê¸°ëŠ¥ë§Œ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ—ï¸ êµ¬ì¡°

### 1. whereBuilder ìŠ¤í† ì–´ (ê°„ì†Œí™”ë¨)
- **íŒŒì¼ ìœ„ì¹˜**: `resources/v2/js/util/whereBuilder.js`
- **ì ‘ê·¼ ë°©ë²•**: `$store.whereBuilder`
- **ê¸°ëŠ¥**: where ì ˆ ì¡°í•©ë§Œ ë‹´ë‹¹ (ì„¤ì • ê¸°ëŠ¥ ì œê±°ë¨)
- ëª¨ë“  ëª¨ë¸ì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥

### 2. ë“±ë¡ ë°©ë²•
```javascript
// app.v2.jsì—ì„œ ë“±ë¡
import whereBuilder from './util/whereBuilder.js';
Alpine.store('whereBuilder', whereBuilder);
```

### 3. í•„í„° êµ¬ì¡°
```javascript
filters: {
    // where ì ˆìš© í•„í„°ë“¤ (bladeì—ì„œ ì§ì ‘ ì„¤ì •)
    where: {
        category: '',           // ê¸°ë³¸ ë“±í˜¸ ë¹„êµ
        hit: '>:100',          // í¬ê¸° ë¹„êµ
        title: 'like:ì œëª©',     // LIKE ê²€ìƒ‰
        status: 'whereIn:1,2'   // IN ì¡°ê±´
    },
    // ì¼ë°˜ í•„í„°ë“¤
    search_text: '',
    page: 1,
    paginate: 10
}
```

## ğŸ“ Bladeì—ì„œ ì‚¬ìš©ë²• (ì§ì ‘ í• ë‹¹)

### 1. ê¸°ë³¸ ë“±í˜¸ ë¹„êµ
```blade
<x-forms.select
    name="category"
    model="filters.where.category"
    :options="$categories"
    placeholder="ì „ì²´ ì¹´í…Œê³ ë¦¬"
    @change="onWhereFilterChange()"
    no-margin
    :errors="null"
/>
```

### 2. ë¹„êµ ì—°ì‚°ì
```blade
<!-- ì¡°íšŒìˆ˜ ìµœì†Œê°’ -->
<input type="number"
       @input="filters.where.hit = '>=:' + $event.target.value; onWhereFilterChange()"
       class="form-control"
       placeholder="ìµœì†Œ ì¡°íšŒìˆ˜">

<!-- ì ìˆ˜ ìµœëŒ€ê°’ -->
<input type="number"
       @input="filters.where.score = '<=:' + $event.target.value; onWhereFilterChange()"
       class="form-control"
       placeholder="ìµœëŒ€ ì ìˆ˜">
```

### 3. ë²”ìœ„ ê²€ìƒ‰ (ë¶„ë¦¬ëœ í‚¤ ì‚¬ìš©)
```blade
<!-- ì¡°íšŒìˆ˜ ë²”ìœ„ -->
ìµœì†Œ: <input type="number"
            @input="filters.where.hit_min = '>=:' + $event.target.value; onWhereFilterChange()"
            placeholder="ìµœì†Œ ì¡°íšŒìˆ˜">
ìµœëŒ€: <input type="number"
            @input="filters.where.hit_max = '<=:' + $event.target.value; onWhereFilterChange()"
            placeholder="ìµœëŒ€ ì¡°íšŒìˆ˜">
```

### 4. LIKE ê²€ìƒ‰
```blade
<input type="text"
       @input="filters.where.title = 'like:' + $event.target.value; onWhereFilterChange()"
       class="form-control"
       placeholder="ì œëª© ê²€ìƒ‰">
```

### 5. IN ì¡°ê±´ (ì—¬ëŸ¬ ê°’ ì„ íƒ)
```blade
<select multiple 
        @change="
            const values = Array.from($event.target.selectedOptions).map(o => o.value);
            filters.where.category = 'whereIn:' + values.join(',');
            onWhereFilterChange();
        ">
    <option value="notice">ê³µì§€ì‚¬í•­</option>
    <option value="faq">FAQ</option>
    <option value="event">ì´ë²¤íŠ¸</option>
</select>
```

### 6. NULL ì²´í¬
```blade
<button @click="
    filters.where.category = '_null';
    onWhereFilterChange();
" class="btn btn-outline-secondary">
    ì¹´í…Œê³ ë¦¬ ì—†ëŠ” ê¸€
</button>
```

### 7. ì¡°ê±´ ì´ˆê¸°í™”
```blade
<button @click="
    Object.keys(filters.where).forEach(key => filters.where[key] = '');
    filters.search_text = '';
    resetSearch();
" class="btn btn-outline-secondary">
    ì „ì²´ ì´ˆê¸°í™”
</button>
```

## âš¡ whereBuilder ìŠ¤í† ì–´ ë©”ì†Œë“œ (ê°„ì†Œí™”ë¨)

### ğŸ“¥ ìœ ì¼í•œ ê¸°ëŠ¥ë“¤
- `$store.whereBuilder.build(whereFilters, modelName)` - where ì ˆ ìƒì„±
- `$store.whereBuilder.isOperator(value)` - ì—°ì‚°ì í™•ì¸ (ë‚´ë¶€ìš©)

## ğŸ”„ JavaScriptì—ì„œ ì‚¬ìš©ë²•

### articleList.jsì—ì„œ (ëª¨ë¸ëª… ì§€ì •)
```javascript
// API íŒŒë¼ë¯¸í„° êµ¬ì„±
buildApiParams() {
    const params = {
        page: this.filters.page,
        paginate: this.filters.paginate,
        with: 'user',
        order_column: this.order_column,
        order_direction: this.order_direction
    };

    // where ì ˆ ìƒì„± (ëª¨ë¸ëª… ì§€ì •)
    const whereClause = this.$store.whereBuilder.build(this.filters.where, 'articles');
    if (whereClause) {
        params.where = whereClause;
    }

    return params;
}
```

### ë‹¤ë¥¸ ëª¨ë¸ë“¤ì—ì„œ ì‚¬ìš©
```javascript
// ì‚¬ìš©ì ëª©ë¡
const usersWhere = this.$store.whereBuilder.build(this.filters.where, 'users');
// ê²°ê³¼: "users.name:like:í™ê¸¸ë™|users.age:>=:20"

// ëŒ“ê¸€ ëª©ë¡
const commentsWhere = this.$store.whereBuilder.build(this.filters.where, 'comments');  
// ê²°ê³¼: "comments.content:like:ì•ˆë…•|comments.created_at:>=:2024-01-01"

// ì—¬ëŸ¬ ëª¨ë¸ ì¡°í•©
const articlesWhere = this.$store.whereBuilder.build(this.filters.where, 'articles');
const usersWhere = this.$store.whereBuilder.build(this.filters.where, 'users');
const combinedWhere = articlesWhere + '|' + usersWhere;
// ê²°ê³¼: "articles.category:notice|users.name:like:í™ê¸¸ë™"
```

### ë™ì  ì¡°ê±´ ì„¤ì • (ì§ì ‘ í• ë‹¹)
```javascript
// ë³µì¡í•œ ê²€ìƒ‰ ì¡°ê±´ ì„¤ì •
setupAdvancedSearch() {
    // ìµœê·¼ 7ì¼ ì´ë‚´ ê¸€
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    this.filters.where.created_at = '>=:' + weekAgo.toISOString().split('T')[0];
    
    // ì¸ê¸°ê¸€ (ì¡°íšŒìˆ˜ 100 ì´ìƒ)
    this.filters.where.hit = '>=:100';
    
    // íŠ¹ì • ì¹´í…Œê³ ë¦¬ë“¤ë§Œ
    this.filters.where.category = 'whereIn:notice,event,news';
    
    // ì œëª©ì— íŠ¹ì • í‚¤ì›Œë“œ í¬í•¨
    this.filters.where.title = 'like:ì¤‘ìš”';
    
    this.loadArticles();
}
```

## ğŸ¯ ì§€ì›í•˜ëŠ” ì—°ì‚°ì íŒ¨í„´

### ê¸°ë³¸ í˜•ì‹
```javascript
filters.where.í‚¤ = 'ì—°ì‚°ì:ê°’'
```

### ì—°ì‚°ì ì¢…ë¥˜
- **ë“±í˜¸**: `í•„ë“œ = 'ê°’'` (ì—°ì‚°ì ìƒëµ)
- **í¬ê¸° ë¹„êµ**: `í•„ë“œ = '>=:ê°’'`, `í•„ë“œ = '<=:ê°’'`, `í•„ë“œ = '>:ê°’'`, `í•„ë“œ = '<:ê°’'`
- **LIKE**: `í•„ë“œ = 'like:ê°’'`
- **IN**: `í•„ë“œ = 'whereIn:ê°’1,ê°’2,ê°’3'`
- **NULL**: `í•„ë“œ = '_null'`

### ì‹¤ì œ ì˜ˆì‹œ
```javascript
// ë“±í˜¸ ë¹„êµ
filters.where.category = 'notice'                    // articles.category:notice

// í¬ê¸° ë¹„êµ  
filters.where.hit = '>=:100'                        // articles.hit:>=:100
filters.where.price = '<=:50000'                    // articles.price:<=:50000

// LIKE ê²€ìƒ‰
filters.where.title = 'like:ì•ˆë…•í•˜ì„¸ìš”'               // articles.title:like:ì•ˆë…•í•˜ì„¸ìš”

// IN ì¡°ê±´
filters.where.status = 'whereIn:1,2,3'              // articles.status:whereIn:1,2,3

// NULL ì²´í¬
filters.where.deleted_at = '_null'                   // articles.deleted_at:_null
```

## ğŸ¯ API ìŠ¤í™ (ìë™ ìƒì„±)

### Where ì ˆ êµ¬ë¬¸ í˜•ì‹
- **ê¸°ë³¸**: `ëª¨ë¸ëª….í•„ë“œ:ê°’`
- **ë¹„êµ**: `ëª¨ë¸ëª….í•„ë“œ:ì—°ì‚°ì:ê°’`
- **NULL**: `ëª¨ë¸ëª….í•„ë“œ:_null`
- **ì—¬ëŸ¬ ì¡°ê±´**: `ì¡°ê±´1|ì¡°ê±´2|ì¡°ê±´3`

### ì˜ˆì‹œ API í˜¸ì¶œ
```
# ë‹¨ì¼ ëª¨ë¸
?where=articles.category:notice|articles.hit:>=:100

# ì—¬ëŸ¬ ëª¨ë¸ ì¡°í•©
?where=articles.category:notice|users.name:like:í™ê¸¸ë™|comments.content:like:ì•ˆë…•
```

## ğŸ‰ ì¥ì 

### 1. **ê·¹ë„ë¡œ ë‹¨ìˆœí•¨**
- ë©”ì„œë“œ í˜¸ì¶œ ì—†ì´ ì§ì ‘ í• ë‹¹ë§Œ
- `filters.where.í‚¤ = 'ì—°ì‚°ì:ê°’'` íŒ¨í„´ìœ¼ë¡œ í†µì¼
- í•™ìŠµ ë¹„ìš© ìµœì†Œí™”

### 2. **ì™„ë²½í•œ ì¼ê´€ì„±**
- ëª¨ë“  í•„í„°ê°€ ë™ì¼í•œ ë°©ì‹
- ì–´ë–¤ ì—°ì‚°ìë“  ê°™ì€ íŒ¨í„´

### 3. **ë²”ìš©ì„±**
- ëª¨ë“  ëª¨ë¸ì—ì„œ ë™ì¼í•˜ê²Œ ì‚¬ìš©
- ì—¬ëŸ¬ ëª¨ë¸ ì¡°í•© ê°€ëŠ¥

### 4. **ì§ê´€ì„±**
- ì½”ë“œë§Œ ë´ë„ ì˜ë„ê°€ ëª…í™•
- ë””ë²„ê¹… ìš©ì´

## ğŸ” ë””ë²„ê¹… íŒ

ì½˜ì†”ì—ì„œ í˜„ì¬ ìƒíƒœ í™•ì¸:
```javascript
// Alpine DevTools ë˜ëŠ” ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ
$data.filters.where                                              // where ì ˆ í•„í„°ë“¤
$store.whereBuilder.build($data.filters.where, 'articles')      // ìƒì„±ëœ where ì ˆ
$store.whereBuilder.build($data.filters.where, 'users')         // ë‹¤ë¥¸ ëª¨ë¸ë¡œ ìƒì„±
```
